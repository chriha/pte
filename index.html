<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script type="text/javascript">
        Object.filter = (obj, predicate) =>
            Object.fromEntries(Object.entries(obj).filter(predicate));
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        .bg-bug {
            background-color: #a8b820;
        }

        .bg-dark {
            background-color: #705848;
        }

        .bg-dragon {
            background-color: #7038f8;
        }

        .bg-electric {
            background-color: #f8d030;
        }

        .bg-fairy {
            background-color: #ee99ac;
        }

        .bg-fighting {
            background-color: #c03028;
        }

        .bg-fire {
            background-color: #f08030;
        }

        .bg-flying {
            background-color: #a890f0;
        }

        .bg-ghost {
            background-color: #705898;
        }

        .bg-grass {
            background-color: #78c850;
        }

        .bg-ground {
            background-color: #e0c068;
        }

        .bg-ice {
            background-color: #98d8d8;
        }

        .bg-normal {
            background-color: #a8a878;
        }

        .bg-poison {
            background-color: #ab6ac8;
        }

        .bg-psychic {
            background-color: #f85888;
        }

        .bg-rock {
            background-color: #b8a038;
        }

        .bg-steel {
            background-color: #b8b8d0;
        }

        .bg-water {
            background-color: #6890f0;
        }
    </style>
    <title>Pokémon Type Effectiveness</title>
</head>
<body class="bg-gray-900 font-sans antialiased text-white">
<div x-data="{
    types: {},
    selectedType: '',

    async loadTypes() {
        const response = await fetch('/assets/types.json')
        this.types = await response.json()
    },

    effectivenessOf(type, defType) {
        return this.types[type][defType]
    },

    effectivenessFor(mode) {
    console.log(Object.filter(this.types, (k, v) => v === 2));
        if (! this.selectedType) {
            return {super: [], no: [], notVery: [], normal: []}
        }

        let types = Object.entries(this.types);

        if (mode === 'attack') {
            return {
                super: Object.filter(this.types[this.selectedType], ([k, v]) => v === 2),
                normal: Object.filter(this.types[this.selectedType], ([k, v]) => v === 1),
                notVery: Object.filter(this.types[this.selectedType], ([k, v]) => v === 0.5),
                no: Object.filter(this.types[this.selectedType], ([k, v]) => v === 0)

            }
        }
    },
}"
x-init="loadTypes()">

    <div class="p-4 flex flex-col">
        <h1 class="text-2xl text-white font-bold mb-4">Pokémon Type Effectiveness</h1>

        <div class="max-w-2xl md:max-w-4xl mx-auto grid grid-cols-6 md:grid-cols-9 gap-4">

            <template x-for="(type, index) in types" :key="'types-' + index">
                <div class="bg-gray-800 p-2 rounded-lg hover:bg-gray-700 opacity-80 cursor-pointer relative"
                     :class="{'bg-gray-700 ring-1 ring-blue-500 opacity-100': selectedType === index}"
                     x-tooltip="index"
                    @click="selectedType = index">
                    <img class="" :src="'/assets/images/types/' + index + '.png'">
                    <span x-text="index" :class="'bg-' + index"
                          style="text-shadow: 0 0 8px rgba(93, 93, 93, 0.75);"
                          class="absolute pb-0.5 block bottom-0 font-semibold left-0 mt-2 mx-auto rounded-b-lg text-center text-sm w-full"></span>
                </div>
            </template>

        </div>

        <div x-if="selectedType" class="grid grid-cols-2 max-w-2xl md:max-w-4xl mt-8 mx-auto w-full">
            <div>
                <h2 class="font-bold text-center">Attack</h2>
                <div>
                    <div class="mt-2">
                        Super Effective:
                        <template x-for="(type, index) in effectivenessFor('attack', selectedType).super">
                            <span class="rounded-md px-2 py-0.5 ml-2 text-sm font-semibold"
                                  style="text-shadow: 0 0 8px rgba(93, 93, 93, 0.75);"
                                    :class="'bg-' + index"
                                  x-text="index"></span>
                        </template>
                    </div>
                    <div class="mt-2">
                        Not Very Effective:
                        <template x-for="(type, index) in effectivenessFor('attack', selectedType).notVery">
                            <span class="rounded-md px-2 py-0.5 ml-2 text-sm font-semibold"
                                  style="text-shadow: 0 0 8px rgba(93, 93, 93, 0.75);"
                                  :class="'bg-' + index"
                                  x-text="index"></span>
                        </template>
                    </div>
                    <div class="mt-2">
                        Resistant:
                        <template x-for="(type, index) in effectivenessFor('attack', selectedType).no">
                            <span class="rounded-md px-2 py-0.5 ml-2 text-sm font-semibold"
                                  style="text-shadow: 0 0 8px rgba(93, 93, 93, 0.75);"
                                  :class="'bg-' + index"
                                  x-text="index"></span>
                        </template>
                    </div>
                </div>
            </div>

            <div>
                <h2 class="font-bold text-center">Defense</h2>
            </div>
        </div>

        <div x-data="{ expanded: false }" class="max-w-6xl mx-auto w-full mt-8">
            <button @click="expanded = ! expanded" class="text-gray-500">Toggle Table</button>

            <div x-show="expanded" x-collapse>
                <div>
                    <table class="table-fixed w-full text-xs mt-4">
                        <thead>
                        <tr>
                            <th></th>
                            <template x-for="(type, index) in types" :key="'types-table-header-' + index">
                                <th x-text="index"
                                    class="px-2 py-2 capitalize text-ellipsis overflow-hidden text-center"
                                    style="text-shadow: 0 0 8px rgba(93, 93, 93, 0.75);"
                                    :class="'bg-' + index"></th>
                            </template>
                        </tr>
                        </thead>

                        <tbody>
                        <template x-for="(type, index) in types" :key="'types-table-' + index">
                            <tr class="group">
                                <td x-text="index"
                                    class="px-2 py-2 capitalize text-ellipsis overflow-hidden group-hover:bg-gray-700"
                                    style="text-shadow: 0 0 8px rgba(93, 93, 93, 0.75);"
                                    :class="'bg-' + index"></td>
                                <template x-for="(defType, defIndex) in types" :key="'types-table-' + defIndex">
                                    <td x-data="{ effectiveness: effectivenessOf(index, defIndex) }"
                                        class="group-hover:bg-gray-700 font-bold text-center"
                                        style="text-shadow: 0 0 8px rgba(93, 93, 93, 0.75);">

                                        <span x-show="effectiveness !== 1"
                                              class="w-full h-full px-2 py-2 block bg-opacity-20"
                                              :class="{'bg-red-500': effectiveness === 0, 'bg-yellow-500': effectiveness === 0.5, 'bg-green-500': effectiveness > 1}"
                                              x-text="effectiveness"
                                        ></span>
                                    </td>
                                </template>
                            </tr>
                        </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>
</body>
</html>